#!/bin/bash

# Script de configuraรงรฃo de MCPs para OkeSports
# Este script ajuda a configurar os MCPs recomendados no Cursor

echo "๐ Configuraรงรฃo de MCPs para OkeSports"
echo "======================================"
echo ""

# Cores
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# Verificar se estรก no macOS
if [[ "$OSTYPE" != "darwin"* ]]; then
    echo -e "${RED}โ๏ธ  Este script foi otimizado para macOS.${NC}"
    echo "   Para outros sistemas, consulte: docs/MCP_SETUP.md"
    exit 1
fi

# Caminho do arquivo de configuraรงรฃo do Cursor
CURSOR_CONFIG_DIR="$HOME/Library/Application Support/Cursor/User/globalStorage"
MCP_CONFIG_FILE="$CURSOR_CONFIG_DIR/rooveterinaryinc.roo-cline/settings/cline_mcp_settings.json"

echo "๐ Localizando arquivo de configuraรงรฃo do Cursor..."
if [ ! -f "$MCP_CONFIG_FILE" ]; then
    echo -e "${YELLOW}โ๏ธ  Arquivo de configuraรงรฃo nรฃo encontrado.${NC}"
    echo "   Criando diretรณrio..."
    mkdir -p "$(dirname "$MCP_CONFIG_FILE")"
    echo "{}" > "$MCP_CONFIG_FILE"
    echo -e "${GREEN}โ Diretรณrio criado.${NC}"
else
    echo -e "${GREEN}โ Arquivo encontrado.${NC}"
fi

# Ler configuraรงรฃo atual
CURRENT_CONFIG=$(cat "$MCP_CONFIG_FILE" 2>/dev/null || echo "{}")

echo ""
echo "๐ MCPs disponรญveis para configuraรงรฃo:"
echo ""
echo "1. PostgreSQL MCP (Essencial) - Para gerenciar banco de dados"
echo "2. GitHub MCP (Essencial) - Para gerenciar issues e PRs"
echo "3. Filesystem MCP (Recomendado) - Para operaรงรตes de arquivo"
echo "4. Browser MCP (Opcional) - Para testes de interface"
echo ""

read -p "Deseja configurar automaticamente? (s/n): " -n 1 -r
echo ""

if [[ ! $REPLY =~ ^[Ss]$ ]]; then
    echo "Configuraรงรฃo manual:"
    echo "1. Abra: $MCP_CONFIG_FILE"
    echo "2. Use o exemplo em: .cursor-mcp-config.example.json"
    echo "3. Consulte: docs/MCP_SETUP.md"
    exit 0
fi

# Tentar ler DATABASE_URL do .env
echo ""
echo "๐ Procurando configuraรงรตes existentes..."
if [ -f ".env" ]; then
    DB_URL_FROM_ENV=$(grep "^DATABASE_URL=" .env | cut -d '=' -f2- | tr -d '"' | tr -d "'" | xargs)
    if [ ! -z "$DB_URL_FROM_ENV" ]; then
        echo -e "${GREEN}โ DATABASE_URL encontrado no .env${NC}"
        DB_URL="$DB_URL_FROM_ENV"
    fi
fi

# Solicitar informaรงรตes
echo ""
echo "๐ Configuraรงรฃo de MCPs:"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ percent: 0.0

# Caminho do projeto
PROJECT_PATH=$(pwd)
echo "Caminho do projeto: $PROJECT_PATH"

# Gerar configuraรงรฃo JSON
echo ""
echo "๐ง Gerando configuraรงรฃo..."

CONFIG_JSON=$(cat <<EOF
{
  "mcpServers": {
$(if [ ! -z "$DB_URL" ]; then
cat <<INNER
    "postgres": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-postgres",
        "$DB_URL_ESCAPED"
      ],
      "env": {
        "POSTGRES_CONNECTION_STRING": "$DB_URL_ESCAPED"
      }
    },
INNER
fi)
$(if [ ! -z "$GITHUB_TOKEN" ]; then
cat <<INNER
    "github": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-github"
      ],
      "env": {
        "GITHUB_PERSONAL_ACCESS_TOKEN": "$GITHUB_TOKEN"
      }
    },
INNER
fi)
    "filesystem": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-filesystem",
        "$PROJECT_PATH"
      ]
    },
    "browser": {
      "command": "npx",
      "args": [
        "-y",
        "@modelcontextprotocol/server-browser"
      ]
    }
  }
}
EOF
)

# Salvar configuraรงรฃo
echo "$CONFIG_JSON" > "$MCP_CONFIG_FILE"

echo ""
echo -e "${GREEN}โ Configuraรงรฃo salva em:${NC}"
echo "   $MCP_CONFIG_FILE"
echo ""
echo "๐ Reinicie o Cursor para aplicar as mudanรงas."
echo ""
echo "๐ Documentaรงรฃo completa: docs/MCP_SETUP.md"

